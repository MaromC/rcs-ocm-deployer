apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 30
commands:
  - command: bash -c "export cluster=$(sh ../getClusteOrPlacement.sh cluster); yq e -i 'select(di == 1).spec.site = env(cluster)' 00-deploy-capp-with-cluster.yaml; yq e -i 'select(di == 1).status.applicationLinks.site = env(cluster)' 00-assert.yaml"
---
apiVersion: rcs.dana.io/v1alpha1
kind: Capp
metadata:
  name: capp-with-cluster
spec:
  site: "ocp-rcs-managed-1"
  configurationSpec:
    template:
      metadata:
        creationTimestamp: null
      spec:
        containers:
          - env:
              - name: APP_NAME
                value: capp-with-cluster
            image: 'sahar2339/example-python-app:v1-flask'
            name: capp-with-cluster
            resources: {}
  routeSpec:
    hostname: rbacqwegen.dev
  scaleMetric: cpu
